<!DOCTYPE html>
<html>
<head>
    <title>Chat Room</title>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.3/css/all.min.css" rel="stylesheet"/>
    <style>
        /* ... (your existing styles) */
        .access-key-form {
            /* ... (your existing styles) */
            text-align: center;
        }
        .message.user {
            flex-direction: row-reverse;
        }
        .message.user .avatar {
            margin-left: 10px;
            margin-right: 0;
        }
    </style>
</head>
<body>
    <div class="container" id="container">
        <div class="header">
            <div class="title">Chat Room</div>
            <div id="username-display"></div>
        </div>
        <div class="chat" id="chat-window">
        </div>
        <div class="footer">
            <input id="message-input" placeholder="Message" type="text"/>
            <button id="send-message">Send</button>
        </div>
    </div>

    <div class="access-key-form" id="access-key-form">
        <input type="text" id="access-key-input" placeholder="Access Key">
        <button id="access-key-submit">Enter</button>
    </div>

    <script>
        const jsonBinBinId = '67126120ad19ca34f8bab618';
        const jsonBinMasterKey = '$2a$10$ZhyLvqnODp6F/m/31TwrJOhkAgF2YwNkVT4EwBlXEn.eJWdvTMnRC';

        const accessKeyForm = document.getElementById('access-key-form');
        const accessKeyInput = document.getElementById('access-key-input');
        const accessKeySubmitButton = document.getElementById('access-key-submit');
        const container = document.getElementById('container');
        const chatWindow = document.getElementById('chat-window');
        const messageInput = document.getElementById('message-input');
        const sendMessageButton = document.getElementById('send-message');

        // Access key validation and chat room display
        accessKeySubmitButton.addEventListener('click', () => {
            const accessKey = accessKeyInput.value;

            if (accessKey === 'user_access' || accessKey === 'admin_access') {
                accessKeyForm.style.display = 'none';
                container.style.display = 'flex';
                document.getElementById('username-display').innerText = `Logged in as: ${accessKey}`;

                // Fetch existing messages from JSONBin
                fetch(`https://api.jsonbin.io/v3/${jsonBinBinId}`, {
                    headers: {
                        'secret-key': jsonBinMasterKey
                    }
                })
                .then(response => response.json())
                .then(data => {
                    data.messages.forEach(message => {
                        const messageElement = document.createElement('div');
                        messageElement.className = `message ${message.sender === username ? 'user' : ''}`;
                        messageElement.innerHTML = `<div class="avatar">${message.sender.charAt(0).toUpperCase()}</div><div class="text">${message.message}</div>`;
                        chatWindow.appendChild(messageElement);
                    });
                    chatWindow.scrollTop = chatWindow.scrollHeight;
                })
                .catch(error => {
                    console.error('Error fetching messages:', error);
                });
            } else {
                alert('Invalid access key.');
            }
        });

        // Send message to JSONBin
        sendMessageButton.addEventListener('click', () => {
            const messageText = messageInput.value;

            if (messageText) {
                sendMessageToJSONBin(messageText);
                messageInput.value = '';
            }
        });

        function sendMessageToJSONBin(messageText) {
            const data = {
                message: messageText,
                sender: username
            };

            fetch(`https://api.jsonbin.io/v3/${jsonBinBinId}`, {
                method: 'PUT',
                headers: {
                    'Content-Type': 'application/json',
                    'secret-key': jsonBinMasterKey
                },
                body: JSON.stringify(data)
            })
            .then(response => response.json())
            .then(data => {
                console.log('Message sent successfully:', data);
                // Append the message to the chat window
                const messageElement = document.createElement('div');
                messageElement.className = 'message user';
                messageElement.innerHTML = `<div class="text">${messageText}</div>`;
                chatWindow.appendChild(messageElement);
                chatWindow.scrollTop = chatWindow.scrollHeight;
            })
            .catch(error => {
                console.error('Error sending message:', error);
            });
        }
    </script>
</body>
</html>