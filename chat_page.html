<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Chat Application</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 0; padding: 0; background-color: #f0f0f0; }
        .container { width: 90%; max-width: 600px; margin: 20px auto; }
        h1 { text-align: center; }
        .form { display: flex; flex-direction: column; margin-bottom: 20px; }
        input { padding: 10px; margin: 5px 0; border: 1px solid #ccc; border-radius: 4px; }
        button { padding: 10px; border: none; border-radius: 4px; background-color: #5cb85c; color: white; cursor: pointer; }
        button:hover { background-color: #4cae4c; }
        .chat-container { border: 1px solid #ccc; padding: 10px; border-radius: 4px; background-color: white; max-height: 400px; overflow-y: auto; }
        .chat-bubble { padding: 10px; border-radius: 10px; margin: 5px; max-width: 75%; position: relative; }
        .chat-bubble.me { background-color: #dcf8c6; align-self: flex-end; }
        .chat-bubble.other { background-color: #f1f0f0; align-self: flex-start; }
        .message-container { display: flex; align-items: flex-end; }
        .room-code { text-align: center; font-weight: bold; margin: 10px 0; font-size: 0.8em; }
        .hidden { display: none; }
    </style>
</head>
<body>
    <div class="container">
        <h1>Chat Application</h1>

        <div id="authSection">
            <div id="loginForm" class="form">
                <input type="text" id="loginUsername" placeholder="Username" required>
                <input type="password" id="loginPassword" placeholder="Password" required>
                <button onclick="login()">Login</button>
                <p><button onclick="toggleRegistration()">Register</button></p>
            </div>

            <div id="registrationForm" class="form hidden">
                <input type="text" id="registerUsername" placeholder="Username" required>
                <input type="password" id="registerPassword" placeholder="Password" required>
                <button onclick="register()">Register</button>
                <p><button onclick="toggleRegistration()">Back to Login</button></p>
            </div>
        </div>

        <div id="chatSection" class="hidden">
            <div class="room-code" id="roomCodeDisplay"></div>
            <div class="chat-container" id="chatContainer"></div>
            <input type="text" id="chatInput" placeholder="Type a message..." onkeydown="if(event.key === 'Enter'){sendMessage()}">
            <button onclick="sendMessage()">Send</button>
            <div>
                <button id="hostChatBtn" onclick="createChatRoom()">Host Chat</button>
                <button id="joinChatBtn" onclick="joinChatRoom()">Join Chat</button>
            </div>
        </div>
    </div>

    <script>
        const binId = "6713e37dacd3cb34a899bbcb"; // Your JSONBin ID
        const masterKey = "$2a$10$SjhSiTDW101gGwgR2EMuSeimya/ER6HzCFxrwOkhtxONDwVyeCpPO"; // Your master key
        let username;
        let currentRoomCode;

        function toggleRegistration() {
            document.getElementById('loginForm').classList.toggle('hidden');
            document.getElementById('registrationForm').classList.toggle('hidden');
        }

        function login() {
            const username = document.getElementById('loginUsername').value;
            const password = document.getElementById('loginPassword').value;

            fetch(`https://api.jsonbin.io/v3/b/${binId}`, {
                method: 'GET',
                headers: { 'X-Master-Key': masterKey }
            })
            .then(response => response.json())
            .then(data => {
                const user = data.record.users.find(user => user.username === username && user.password === password);
                if (user) {
                    alert('Login successful!');
                    document.getElementById('authSection').classList.add('hidden');
                    document.getElementById('chatSection').classList.remove('hidden');
                    window.username = username; // Set global username
                } else {
                    alert('Invalid credentials!');
                }
            })
            .catch(err => console.error(err));
        }

        function register() {
            const username = document.getElementById('registerUsername').value;
            const password = document.getElementById('registerPassword').value;

            fetch(`https://api.jsonbin.io/v3/b/${binId}`, {
                method: 'GET',
                headers: { 'X-Master-Key': masterKey }
            })
            .then(response => response.json())
            .then(data => {
                if (data.record.users.find(user => user.username === username)) {
                    alert('Username already exists!');
                    return;
                }
                data.record.users.push({ username, password });
                return fetch(`https://api.jsonbin.io/v3/b/${binId}`, {
                    method: 'PUT',
                    headers: { 'Content-Type': 'application/json', 'X-Master-Key': masterKey },
                    body: JSON.stringify(data.record)
                });
            })
            .then(() => {
                alert('Registration successful! You can now log in.');
                toggleRegistration(); // Go back to login form
            })
            .catch(err => console.error(err));
        }

        function createChatRoom() {
            currentRoomCode = Math.random().toString(36).substring(2, 8); // Generate a unique room code
            document.getElementById('roomCodeDisplay').textContent = `Room Code: ${currentRoomCode}`;
            document.getElementById('chatContainer').innerHTML = ''; // Clear previous messages
            alert(`Chat room created! Code: ${currentRoomCode}`);
        }

        function joinChatRoom() {
            const code = prompt("Enter the room code:");
            if (code) {
                currentRoomCode = code;
                document.getElementById('roomCodeDisplay').textContent = `Room Code: ${currentRoomCode}`;
                document.getElementById('chatContainer').innerHTML = ''; // Clear previous messages
            }
        }

        function sendMessage() {
            const message = document.getElementById('chatInput').value.trim();
            if (!message) return;

            const chatMessage = { username, message };
            const chatContainer = document.getElementById('chatContainer');
            const messageContainer = document.createElement('div');
            const bubble = document.createElement('div');

            bubble.classList.add('chat-bubble');
            bubble.classList.add(username === chatMessage.username ? 'me' : 'other');
            bubble.textContent = chatMessage.message;

            messageContainer.classList.add('message-container');
            messageContainer.appendChild(bubble);
            chatContainer.appendChild(messageContainer);
            document.getElementById('chatInput').value = ''; // Clear input
            chatContainer.scrollTop = chatContainer.scrollHeight; // Scroll to bottom
        }
    </script>
</body>
</html>
