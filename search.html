<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Search Users</title>
    <link rel="stylesheet" href="styles.css">
</head>
<body>
    <div class="container">
        <h1>Search Users</h1>
        <input type="text" id="searchInput" placeholder="Enter username" />
        <button onclick="searchUsers()">Search</button>
        <ul id="userList"></ul>
        <button onclick="goToHomepage()">Back to Homepage</button>
    </div>

    <script>
        // Check if user is logged in
        if (!localStorage.getItem('secretKey')) {
            alert('You must log in first!');
            window.location.href = 'index.html'; // Redirect to login page
        }

        async function searchUsers() {
            const searchInput = document.getElementById('searchInput').value;

            // Fetch users from JSONBin
            const response = await fetch(`https://api.jsonbin.io/v3/b/6715f722ad19ca34f8bbffde/latest`, {
                headers: {
                    'X-Master-Key': '$2a$10$kfsjxxgU.CH/RGF6GziguOZZFzjhlvxiaYAm2bC6l48gnj7WYrbUi'
                }
            });

            const data = await response.json();
            const users = data.record.users || [];

            // Filter users based on the search input
            const filteredUsers = users.filter(user => user.username.includes(searchInput));
            displayUsers(filteredUsers);
        }

        function displayUsers(users) {
            const userList = document.getElementById('userList');
            userList.innerHTML = ''; // Clear previous results

            users.forEach(user => {
                const listItem = document.createElement('li');
                listItem.textContent = user.username;
                listItem.onclick = () => startChat(user.username); // Click to start chat
                userList.appendChild(listItem);
            });

            if (users.length === 0) {
                userList.innerHTML = '<li>No users found</li>';
            }
        }

        function startChat(username) {
            window.location.href = `chat.html?user=${encodeURIComponent(username)}`; // Redirect to chat page
        }

        function goToHomepage() {
            window.location.href = 'homepage.html'; // Redirect to homepage
        }
    </script>
</body>
</html>