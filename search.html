<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Search Users</title>
    <link rel="stylesheet" href="styles.css">
</head>
<body>
    <div class="container">
        <h1>Search Users</h1>
        <input type="text" id="usernameInput" placeholder="Enter username to search..." />
        <button onclick="searchUser()">Search</button>
        <div id="userList" class="messages"></div>
        <button onclick="goToHomepage()">Back to Homepage</button>
    </div>

    <script>
        // Check if user is logged in
        if (!localStorage.getItem('secretKey')) {
            alert('You must log in first!');
            window.location.href = 'index.html'; // Redirect to login page
        }

        async function fetchUsers() {
            const response = await fetch(`https://api.jsonbin.io/v3/b/6715f722ad19ca34f8bbffde/latest`, {
                headers: {
                    'X-Master-Key': '$2a$10$kfsjxxgU.CH/RGF6GziguOZZFzjhlvxiaYAm2bC6l48gnj7WYrbUi'
                }
            });

            const data = await response.json();
            const users = data.record.users || [];

            displayUsers(users);
        }

        function displayUsers(users) {
            const userListContainer = document.getElementById('userList');
            userListContainer.innerHTML = ''; // Clear previous users

            users.forEach(user => {
                const userDiv = document.createElement('div');
                userDiv.className = 'user-item';
                userDiv.textContent = user.username; // Display username
                userDiv.onclick = () => {
                    window.location.href = `chat.html?user=${user.username}`; // Redirect to chat page
                };
                userListContainer.appendChild(userDiv);
            });
        }

        async function searchUser() {
            const username = document.getElementById('usernameInput').value;
            const response = await fetch(`https://api.jsonbin.io/v3/b/6715f722ad19ca34f8bbffde/latest`, {
                headers: {
                    'X-Master-Key': '$2a$10$kfsjxxgU.CH/RGF6GziguOZZFzjhlvxiaYAm2bC6l48gnj7WYrbUi'
                }
            });

            const data = await response.json();
            const users = data.record.users || [];
            const foundUser = users.find(user => user.username === username);

            const userListContainer = document.getElementById('userList');
            userListContainer.innerHTML = ''; // Clear previous users

            if (foundUser) {
                const userDiv = document.createElement('div');
                userDiv.className = 'user-item';
                userDiv.textContent = foundUser.username; // Display found username
                userDiv.onclick = () => {
                    window.location.href = `chat.html?user=${foundUser.username}`; // Redirect to chat page
                };
                userListContainer.appendChild(userDiv);
            } else {
                userListContainer.textContent = 'User not found.';
            }
        }

        function goToHomepage() {
            window.location.href = 'homepage.html'; // Redirect to homepage
        }

        // Fetch users on page load
        fetchUsers();
    </script>
</body>
</html>