<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>My Chats</title>
    <link rel="stylesheet" href="styles.css">
</head>
<body>
    <div class="container">
        <h1>My Chats</h1>
        <div id="chatList" class="messages"></div>
        <button onclick="goToHomepage()">Back to Homepage</button>
    </div>

    <script>
        // Check if user is logged in
        if (!localStorage.getItem('secretKey')) {
            alert('You must log in first!');
            window.location.href = 'index.html'; // Redirect to login page
        }

        async function fetchMyChats() {
            const response = await fetch(`https://api.jsonbin.io/v3/b/6715f722ad19ca34f8bbffde/latest`, {
                headers: {
                    'X-Master-Key': '$2a$10$kfsjxxgU.CH/RGF6GziguOZZFzjhlvxiaYAm2bC6l48gnj7WYrbUi'
                }
            });

            const data = await response.json();
            const chats = data.record.chats || [];

            displayChats(chats);
        }

        function displayChats(chats) {
            const chatListContainer = document.getElementById('chatList');
            chatListContainer.innerHTML = ''; // Clear previous chats

            chats.forEach(chat => {
                const chatDiv = document.createElement('div');
                chatDiv.className = 'chat-item';
                chatDiv.textContent = `Chat with ${chat.with}`;
                chatDiv.onclick = () => {
                    window.location.href = `chat.html?user=${chat.with}`; // Redirect to chat page
                };
                chatListContainer.appendChild(chatDiv);
            });
        }

        function goToHomepage() {
            window.location.href = 'homepage.html'; // Redirect to homepage
        }

        // Fetch chats on page load
        fetchMyChats();
    </script>
</body>
</html>